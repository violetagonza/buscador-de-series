"use strict";const btn=document.querySelector(".js-btn"),input=document.querySelector(".js-input");let deleteIcons,clickedFavID,foundFavForDelete,clickedID,foundShow,searchResults=[],favs=[];function handlebtn(e){e.preventDefault(),fetch(`//api.tvmaze.com/search/shows?q=${input.value}`).then(e=>e.json()).then(e=>{searchResults=e;for(let e=0;e<searchResults.length;e++)null===searchResults[e].show.image?searchResults[e].image="https://via.placeholder.com/210x295/ffffff/666666/? text=TV":searchResults[e].image=searchResults[e].show.image.medium;paintResults()})}function paintResults(){const e=document.querySelector(".js-list");e.innerHTML="";let s="";for(let e=0;e<searchResults.length;e++)s+=`<li title="Click para aÃ±adir a favoritos" id="${searchResults[e].show.id}" class="main--list__item card--normal js-card"> <p class="main--list__text">${searchResults[e].show.name}</p>`,s+=`<img src="${searchResults[e].image}" alt="${searchResults[e].show.name}"></li>`;e.innerHTML=s,addOrRemoveClassInCards(),listenCards()}function addOrRemoveClassInCards(){for(let e=0;e<searchResults.length;e++)for(let s=0;s<favs.length;s++)searchResults[e].show.id===favs[s].id?document.getElementById(searchResults[e].show.id).classList.add("card--fav"):document.getElementById(searchResults[e].show.id).classList.add("card--normal")}function addOrDeleteFavs(){let e,s=!1;for(let t=0;t<favs.length;t++)foundShow.show.id===favs[t].id&&(s=!0,e=t);!1===s?favs.push({id:foundShow.show.id,name:foundShow.show.name,imgurl:foundShow.image}):favs.splice(e,1),paintFavs(),paintResults(),setInLocalStorage()}function deleteFav(){for(let e=0;e<favs.length;e++)foundFavForDelete.id===favs[e].id&&favs.splice(e,1);paintFavs(),paintResults(),setInLocalStorage()}function paintFavs(){const e=document.querySelector(".js-fav-list");let s="";for(let e=0;e<favs.length;e++)s+=`<li><div class="aside--list-div"><p class="aside--list__text">${favs[e].name}</p>`,s+=`<i id="${favs[e].id}" class="js-icon aside--list__icon fas fa-trash-alt" title="Borrar serie"></i></div>`,s+=`<img class="aside--list__img" src="${favs[e].imgurl}" alt="${favs[e].name}"></li>`;function t(e){clickedFavID=e.currentTarget.id,foundFavForDelete=function(){for(const e of favs)if(e.id===parseInt(clickedFavID))return e;return}(),deleteFav(),setInLocalStorage(),paintResults()}s+='<button class="js-reset-btn aside--list__reset" title="Borrar todos los favoritos"> Borrar todos los favoritos</button>',e.innerHTML=s,deleteIcons=document.querySelectorAll(".js-icon");for(const e of deleteIcons)e.addEventListener("click",t);document.querySelector(".js-reset-btn").addEventListener("click",(function(){favs=[],setInLocalStorage(),paintFavs(),paintResults()}))}function handleCard(e){e.currentTarget.classList.contains("card--normal")?(e.currentTarget.classList.remove("card--normal"),e.currentTarget.classList.add("card--fav")):e.currentTarget.classList.contains("card--fav")&&(e.currentTarget.classList.remove("card--fav"),e.currentTarget.classList.add("card--normal")),clickedID=e.currentTarget.id,foundShow=findShowforFavs(clickedID,searchResults),addOrDeleteFavs(),paintFavs(),setInLocalStorage()}function listenCards(){const e=document.querySelectorAll(".js-card");for(const s of e)s.addEventListener("click",handleCard)}function findShowforFavs(e,s){for(const t of s)if(t.show.id===parseInt(e))return t}function getFromLS(){const e=localStorage.getItem("favorite shows");null!==e&&(favs=JSON.parse(e),paintFavs())}function setInLocalStorage(){localStorage.setItem("favorite shows",JSON.stringify(favs))}btn.addEventListener("click",handlebtn),getFromLS();